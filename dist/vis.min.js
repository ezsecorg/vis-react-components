!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("react"),require("d3"),require("react-dom"),require("d3-tip"));else if("function"==typeof define&&define.amd)define(["react","d3","react-dom","d3-tip"],t);else{var n="object"==typeof exports?t(require("react"),require("d3"),require("react-dom"),require("d3-tip")):t(e.React,e.d3,e.ReactDOM,e["d3-tip"]);for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(e,t,n,r){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="/",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(6);Object.defineProperty(t,"Chart",{enumerable:!0,get:function(){return r(o)["default"]}});var a=n(7);Object.defineProperty(t,"Choropleth",{enumerable:!0,get:function(){return r(a)["default"]}});var i=n(8);Object.defineProperty(t,"Heatmap",{enumerable:!0,get:function(){return r(i)["default"]}});var s=n(9);Object.defineProperty(t,"Histogram",{enumerable:!0,get:function(){return r(s)["default"]}});var l=n(11);Object.defineProperty(t,"Scatterplot",{enumerable:!0,get:function(){return r(l)["default"]}})},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(1),u=r(l),c=n(3),p=r(c),f=n(2),d=r(f),h=function(e,t){var n="...";return e.length>t+n.length?e.substring(0,t)+"...":e},y=function(e){function t(e){o(this,t);var n=a(this,Object.getPrototypeOf(t).call(this,e)),r="linear";return"function"==typeof e.scale.rangePoints&&(r="ordinal"),n.state={range:0,ticks:0,scaleType:r},n.axis=d["default"].svg.axis().scale(e.scale).orient(e.orient).ticks(e.tickCount?e.tickCount:0),n}return i(t,e),s(t,[{key:"componentDidMount",value:function(){this.resizeAxis(this.props)}},{key:"componentDidUpdate",value:function(){this.resizeAxis(this.props)}},{key:"componentWillReceiveProps",value:function(e){var t=e.scale.range()[1]-e.scale.range()[0];this.setState({range:t})}},{key:"resizeAxis",value:function(e){var t=this,n=p["default"].findDOMNode(this),r=n.parentNode,o="."+e.className.replace(/ /g,"."),a=d["default"].select(r).select(o),i=0,s=[];e.data.length>0&&e.scale.domain().length>0&&e.scale.range().length>0&&(i=e.tickCount?e.tickCount:"y"===e.type?3:e.scale.domain().length,s=e.tickValues?e.tickValues:"ordinal"!==this.state.scaleType?null:e.scale.domain(),"ordinal"===this.state.scaleType&&!function(){var n=0,r=12;if("top"===e.orient||"bottom"===e.orient){var o=Math.floor(e.scale.range()[i-1]/i);n=Math.floor(o/r)}else n="left"===e.orient?e.margin.left:e.margin.right;t.axis.tickFormat(function(e){return h(e,n)})}(),e.tickFormat&&this.axis.tickFormat(function(t,n){return e.tickFormat(t,n)})),this.axis.scale(e.scale).orient(e.orient).tickValues(s).ticks(i),a.call(this.axis)}},{key:"render",value:function(){var e=this.props,t="";return"x"===e.type&&"bottom"===e.orient&&(t="translate(0,"+e.chartHeight+")"),e.label?u["default"].createElement("g",{className:e.className,transform:t},u["default"].createElement("text",{className:"label"},e.label)):u["default"].createElement("g",{className:e.className,transform:t})}}]),t}(u["default"].Component);y.defaultProps={type:"x",orient:"left",tickValues:!1,tickCount:!1,tickFormat:!1,dx:"",dy:"",label:"",xPos:6,yPos:200},y.propTypes={orient:l.PropTypes.string.isRequired,type:l.PropTypes.string.isRequired,tickValues:u["default"].PropTypes.oneOfType([u["default"].PropTypes.array,u["default"].PropTypes.bool]),tickCount:u["default"].PropTypes.oneOfType([u["default"].PropTypes.number,u["default"].PropTypes.bool]),tickFormat:u["default"].PropTypes.oneOfType([u["default"].PropTypes.func,u["default"].PropTypes.bool]),dx:l.PropTypes.string,dy:l.PropTypes.string,label:l.PropTypes.string,scale:l.PropTypes.any},t["default"]=y},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(1),p=r(c),f=n(3),d=r(f),h=function(e){function t(e){a(this,t);var n=i(this,Object.getPrototypeOf(t).call(this,e));return n.onClick=e.onClick.bind(n),n.onMouseEnter=n._onMouseEnter.bind(n),n.onMouseLeave=n._onMouseLeave.bind(n),n}return s(t,e),u(t,[{key:"_onMouseEnter",value:function(){if(this.props.tooltipData){var e=d["default"].findDOMNode(this);this.props.onEnter(this.props.tooltipData,e)}}},{key:"_onMouseLeave",value:function(){if(this.props.tooltipData){var e=d["default"].findDOMNode(this);this.props.onLeave(this.props.tooltipData,e)}}}]),u(t,[{key:"componentWillUnmount",value:function(){this._onMouseLeave()}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.data,r=e.name,a=o(e,["className","data","name"]);return t="bar "+t,p["default"].createElement("rect",l({className:t,"data-name":r,"data-x":n.x,"data-y":n.y},a,{onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave}))}}]),t}(p["default"].Component);h.defaultProps={className:"bar",height:0,name:"",width:0,onClick:function(){return null},tooltipData:null,y:0},h.propTypes={className:c.PropTypes.string.isRequired,data:c.PropTypes.object,height:c.PropTypes.number.isRequired,name:c.PropTypes.string,width:c.PropTypes.number.isRequired,onClick:c.PropTypes.func,onEnter:c.PropTypes.func,onLeave:c.PropTypes.func,tooltipData:c.PropTypes.object,y:c.PropTypes.number.isRequired},h.contextTypes={filterField:c.PropTypes.string,filterType:c.PropTypes.string,params:c.PropTypes.object,updateFilter:c.PropTypes.func},t["default"]=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),c=r(u),p=n(13),f=r(p),d=n(2),h=r(d),y=n(15),m=r(y),g=n(4),v=r(g),b=n(10),P=r(b),T=n(12),x=r(T),E=function(e){function t(e){o(this,t);var n=a(this,Object.getPrototypeOf(t).call(this,e));return n.onEnter=n._onEnter.bind(n),n.onLeave=n._onLeave.bind(n),n.tip=e.tipFunction?(0,m["default"])().attr("class","d3-tip").html(e.tipFunction):e.tipFunction,n.setXScale=n.setXScale.bind(n),n.setYScale=n.setYScale.bind(n),n.state={chartWidth:e.width,chartHeight:e.width,xScaleType:e.xScaleType,yScaleType:e.yScaleType},n.setXScale(n.state),n.setYScale(n.state),n}return i(t,e),l(t,[{key:"_onEnter",value:function(e,t){e&&this.tip&&this.tip.show(e,t)}},{key:"_onLeave",value:function(e,t){e&&this.tip&&this.tip.hide(e,t)}}]),l(t,[{key:"setXScale",value:function(e){"ordinal"===e.xScaleType?(this.xScale=h["default"].scale.ordinal(),this.xScale.rangeRoundBands([0,e.chartWidth])):"temporal"===e.xScaleType?this.xScale=h["default"].time.scale.utc():"log"===e.xScaleType?this.xScale=h["default"].scale.log():"power"===e.xScaleType?this.xScale=h["default"].scale.pow().exponent(.5):this.xScale=h["default"].scale.linear()}},{key:"setYScale",value:function(e){"ordinal"===e.yScaleType?(this.yScale=h["default"].scale.ordinal(),this.yScale.rangeRoundBands([e.chartHeight,0])):"temporal"===e.yScaleType?this.yScale=h["default"].time.scale.utc():"log"===e.yScaleType?this.yScale=h["default"].scale.log():"power"===e.yScaleType?this.yScale=h["default"].scale.pow().exponent(.5):this.yScale=h["default"].scale.linear()}},{key:"shouldComponentUpdate",value:function(e,t){var n=e.data.length!==this.props.data.length,r=e.loading!==this.props.loading,o=t.xScaleType!==this.state.xScaleType,a=t.yScaleType!==this.state.yScaleType;return o&&(this.setXScale(t),this.resizeChart()),a&&(this.setYScale(t),this.resizeChart()),n||r||a}},{key:"componentWillUpdate",value:function(e){}},{key:"componentWillReceiveProps",value:function(e){}},{key:"componentDidMount",value:function(){this._handleResize=(0,f["default"])(this.resizeChart.bind(this),500),window.addEventListener("resize",this._handleResize,!1),this.resizeChart(),this.tip&&h["default"].select(this.refs.svgRoot).call(this.tip)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this._handleResize,!1)}},{key:"resizeChart",value:function(){var e=this,t=this.props,n=this.refs.rootElement.getBoundingClientRect(),r=h["default"].select(this.refs.svgRoot),o=0===t.width?n.width-t.margin.left-t.margin.right:Math.min(n.width-t.margin.left-t.margin.right,t.width-t.margin.left-t.margin.right),a=t.height-t.margin.top-t.margin.bottom;r.attr("width",0===t.width?n.width:t.width).attr("height",t.height),"ordinal"===t.yScaleType?this.yScale.rangeRoundBands([a,0]):this.yScale.range([a,0]),"ordinal"===t.xScaleType?this.xScale.rangeRoundBands([0,o]):this.xScale.range([0,o]),this.setState({chartWidth:o,chartHeight:a},function(){e.forceUpdate()})}},{key:"renderChild",value:function(){return(0,u.cloneElement)(u.Children.only(this.props.children),{data:this.props.data,loading:this.props.loading,status:this.props.status,chartWidth:this.state.chartWidth,chartHeight:this.state.chartHeight,ref:"child",xScale:this.xScale,xScaleType:this.props.xScaleType,yScale:this.yScale,yScaleType:this.props.yScaleType,onEnter:this.onEnter,onLeave:this.onLeave})}},{key:"render",value:function(){var e=this.props,t=e.margin,n=e.margin.left,r=e.margin.top,o=this.renderChild();return c["default"].createElement("div",{ref:"rootElement",className:e.className,style:{position:"relative"}},c["default"].createElement("svg",{ref:"svgRoot"},c["default"].createElement("g",{ref:"container",className:"container",transform:"translate("+n+","+r+")"},o,c["default"].createElement("g",{className:"chart-title"},c["default"].createElement("text",{y:-e.margin.top+1,dy:"0.71em"},e.title.replace(/_/g," "))),e.xAxis?c["default"].createElement(v["default"],s({className:"x axis",margin:t},e.xAxis,{data:e.data,scale:this.xScale},this.state)):void 0,e.yAxis?c["default"].createElement(v["default"],s({className:"y axis",margin:t},e.yAxis,{data:e.data,scale:this.yScale},this.state)):void 0,e.legend?c["default"].createElement(P["default"],{margin:t,width:this.state.chartWidth,height:this.state.chartHeight,component:this.refs.child}):void 0)),e.settings?c["default"].createElement(x["default"],{settings:e.settings,chart:this}):void 0)}}]),t}(c["default"].Component);E.defaultProps={className:"",settings:!1,data:{},title:"",xAxis:{type:"x",orient:"bottom",tickValues:!1},yAxis:{type:"y",orient:"left"},legend:!1,margin:{top:15,right:10,bottom:20,left:80},width:0,height:250,rangePadding:25,xScaleType:"ordinal",yScaleType:"linear",tipFunction:null},E.propTypes={title:u.PropTypes.string,xAxis:u.PropTypes.oneOfType([u.PropTypes.object,u.PropTypes.bool]),yAxis:u.PropTypes.oneOfType([u.PropTypes.object,u.PropTypes.bool]),legend:u.PropTypes.oneOfType([u.PropTypes.object,u.PropTypes.bool]),children:u.PropTypes.any,className:u.PropTypes.string,loading:u.PropTypes.bool,margin:u.PropTypes.object,width:u.PropTypes.number,height:u.PropTypes.number,xScaleType:u.PropTypes.string,xDomain:u.PropTypes.array,yScaleType:u.PropTypes.string,rangePadding:u.PropTypes.number,data:u.PropTypes.oneOfType([c["default"].PropTypes.object,c["default"].PropTypes.array]),status:u.PropTypes.string,tipFunction:u.PropTypes.func},t["default"]=E},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(1),u=r(l),c=n(2),p=r(c),f=n(14),d=r(f),h=function(e){function t(e){o(this,t);var n=a(this,Object.getPrototypeOf(t).call(this,e));return n.state={colorScale:p["default"].scale.quantile()},n.projection=p["default"].geo.equirectangular(),n.path=p["default"].geo.path().projection(n.projection),n.tooltipData=n.tooltipData.bind(n),n.onClick=n.onClick.bind(n),n.onEnter=n.onEnter.bind(n),n.onLeave=n.onLeave.bind(n),n.renderLoadAnimation=n.renderLoadAnimation.bind(n),n.renderMap=n.renderMap.bind(n),n}return i(t,e),s(t,[{key:"tooltipData",value:function n(e){var t=this,r=-1;this.props.data[0].bins.forEach(function(n,o){if(n[t.props.keyField]===e)return r=o,!1});var o=this.props.data[0].bins[r],a=this.props.data[1].bins[r],i="undefined"==typeof o||"undefined"==typeof a?[0,0]:[a[this.props.valueField],o[this.props.valueField]],n={key:e,value:i};return n}},{key:"onClick",value:function(e){var t=e.target,n=t.getAttribute("data-id");this.props.onClick.apply(this,[n]),this.props.onLeave(this.tooltipData(n),t)}},{key:"onEnter",value:function(e){var t=e.target,n=t.getAttribute("data-id");this.props.onEnter(this.tooltipData(n),t)}},{key:"onLeave",value:function(e){var t=e.target,n=t.getAttribute("data-id");this.props.onLeave(this.tooltipData(n),t)}},{key:"renderMap",value:function(){var e=this,t=this.path.bounds(d["default"].feature(this.props.map,this.props.map.objects.countries)),n=this.projection.scale(),r=n*this.props.chartWidth/(t[1][0]-t[0][0]),o=n*this.props.chartHeight/(t[1][1]-t[0][1]);n=r<o?r:o,this.projection.scale(n).translate([this.props.chartWidth/2,this.props.chartHeight/2]),this.path.projection(this.projection);var a=p["default"].scale.linear().domain([0,this.props.numColorCat]).range([this.props.minColor,this.props.maxColor]).interpolate(p["default"].interpolateHcl),i=[0];this.props.data[1].bins.forEach(function(t){var n=t[e.props.valueField];n>0&&i.push(n)});var s=[];p["default"].range(this.props.numColorCat).map(function(e){s.push(a(e))}),this.state.colorScale.domain(i).range(s);var l=function(t){var n=-1;e.props.data[1].bins.forEach(function(r,o){if(r[e.props.keyField]===t)return n=o,!1});var r=e.props.data[1].bins[n],o=e.props.minColor;return"undefined"!=typeof r&&(o=e.state.colorScale(r[e.props.valueField])),o};return u["default"].createElement("g",null,u["default"].createElement("g",null,d["default"].feature(this.props.map,this.props.map.objects.countries).features.map(function(t,n){return u["default"].createElement("path",{key:n,"data-id":t.id,d:e.path(t,n),fill:l(t.id),onClick:e.onClick,onMouseEnter:e.onEnter,onMouseLeave:e.onLeave})})),u["default"].createElement("g",null,u["default"].createElement("path",{d:this.path(d["default"].mesh(this.props.map,this.props.map.objects.countries,function(e,t){return e!==t})),className:"boundary"})))}},{key:"renderLoadAnimation",value:function(){var e=Math.floor(this.props.chartWidth/2),t=Math.floor(this.props.chartHeight/2),n="Loading data...";return this.props.loading||(n="Failed to fetch"===this.props.status?"Can't connect to API URL":"OK"!==this.props.status?"Error retrieving data: "+this.props.status:"No data returned!"),u["default"].createElement("g",{className:"loading-message"},u["default"].createElement("text",{x:e,y:t},n))}},{key:"render",value:function(){var e=null;return e=this.renderLoadAnimation(this.props),this.props.data.length>0&&(e=this.renderMap(this.props)),e}}]),t}(u["default"].Component);h.defaultProps={minColor:"#eff3ff",maxColor:"#2171b5",numColorCat:20,chartHeight:0,chartWidth:0,className:"choropleth",data:[],keyField:"key",valueField:"value",loading:!1,status:"",type:"",onClick:function(){},onEnter:function(){},onLeave:function(){}},h.propTypes={minColor:l.PropTypes.string,maxColor:l.PropTypes.string,numColorCat:l.PropTypes.number,map:l.PropTypes.object.isRequired,chartHeight:l.PropTypes.number.isRequired,chartWidth:l.PropTypes.number.isRequired,className:l.PropTypes.string.isRequired,data:l.PropTypes.array,keyField:l.PropTypes.string,valueField:l.PropTypes.string,loading:l.PropTypes.bool,onClick:l.PropTypes.func,onEnter:l.PropTypes.func,onLeave:l.PropTypes.func,status:l.PropTypes.string},h.contextTypes={filterField:l.PropTypes.string,filterType:l.PropTypes.string,params:l.PropTypes.object,updateFilter:l.PropTypes.func},t["default"]=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(1),p=r(c),f=n(2),d=r(f),h=function(e){function t(e){a(this,t);var n=i(this,Object.getPrototypeOf(t).call(this,e));return n.state={colorScale:d["default"].scale.quantile(),xDomain:n.props.xDomain,yDomain:n.props.yDomain},n.onClick=n.onClick.bind(n),n.onEnter=n.onEnter.bind(n),n.onLeave=n.onLeave.bind(n),n.renderLoadAnimation=n.renderLoadAnimation.bind(n),n.renderHeatmap=n.renderHeatmap.bind(n),n}return s(t,e),u(t,[{key:"componentWillReceiveProps",value:function(e){if(e.data.length>0){var t=e.xDomain;if(0===t.length){var n=e.data[0].bins[1][e.xKeyField]-e.data[0].bins[0][e.xKeyField];t="ordinal"===e.xScaleType?e.data[0].bins.map(function(t){return t[e.xKeyField]}):d["default"].extent(e.data[0].bins,function(t){return t[e.xKeyField]}),t[1]=t[1]+n}var r=e.yDomain;0===r.length&&(r="ordinal"===e.yScaleType?e.data.map(function(t){return t[e.yKeyField]}):d["default"].extent(e.data,function(t){return t[e.yKeyField]})),t!==this.state.xDomain&&(this.props.xScale.domain(t),this.setState({xDomain:t})),r!==this.state.yDomain&&(this.props.yScale.domain(r),this.setState({yDomain:r}));for(var o=e.colorPerRow?d["default"].max(e.data,function(t,n){return d["default"].max(t.bins,function(t,n){return t[e.xValueField]})}):d["default"].max(e.data,function(t,n){return t[e.yValueField]}),a=d["default"].scale.linear().domain([0,o]).range([e.minColor,e.maxColor]).interpolate(d["default"].interpolateHcl),i=[0,1],s=[e.minColor],l=o/(e.numColorCat-1),u=2;u<e.numColorCat+1;u++){var c=i[u-1]+l;2===u&&c--,i.push(c),s.push(a(c))}this.state.colorScale.domain(i).range(s)}}},{key:"onClick",value:function(e){this.props.onClick(e)}},{key:"onEnter",value:function(e){var t=e.target;this.props.onEnter(this.tooltipData(t),t)}},{key:"onLeave",value:function(e){var t=e.target;this.props.onLeave(this.tooltipData(t),t)}},{key:"tooltipData",value:function(e){var t=e.getAttribute("data-key"),n=e.getAttribute("data-value");return{key:t,value:n}}},{key:"renderHeatmap",value:function(e){var t=this;return p["default"].createElement("g",{className:"heatmap"},e.data.map(function(n,r){return n.bins.map(function(o,a){var i={"data-key":o[e.labelField],"data-value":o[e.xValueField],x:e.xScale(o[e.xKeyField]),y:e.yScale(n[e.yKeyField]),width:e.chartWidth/n.bins.length,height:e.chartHeight/e.data.length,fill:t.state.colorScale(o[e.xValueField]),onMouseEnter:t.onEnter,onMouseLeave:t.onLeave,onClick:t.onClick};return p["default"].createElement("rect",l({key:r+a},i))})}))}},{key:"renderLoadAnimation",value:function(){var e=this.props,t=e.chartWidth,n=e.chartHeight,r=o(e,["chartWidth","chartHeight"]),a=Math.floor(t/2),i=Math.floor(n/2),s="Loading data...";return r.loading||(s="Failed to fetch"===r.status?"Can't connect to API URL":"OK"!==r.status?"Error retrieving data: "+r.status:"No data returned!"),p["default"].createElement("g",{className:"loading-message"},p["default"].createElement("text",{x:a,y:i},s))}},{key:"render",value:function(){var e=null;return e=this.renderLoadAnimation(this.props),this.props.data.length>0&&(e=this.renderHeatmap(this.props)),e}}]),t}(p["default"].Component);h.defaultProps={minColor:"#eff3ff",maxColor:"#2171b5",numColorCat:11,colorPerRow:!0,labelField:"label",chartHeight:0,chartWidth:0,className:"histogram",data:[],xDomain:[],xKeyField:"key",xValueField:"value",yDomain:[],yKeyField:"key",yValueField:"value",loading:!1,status:"",onClick:function(){},onEnter:function(){},onLeave:function(){}},h.propTypes={minColor:c.PropTypes.string,maxColor:c.PropTypes.string,numColorCat:c.PropTypes.number,colorPerRow:c.PropTypes.bool,labelField:c.PropTypes.string,xDomain:c.PropTypes.array,xKeyField:c.PropTypes.string,xValueField:c.PropTypes.string,yDomain:c.PropTypes.array,yKeyField:c.PropTypes.string,yValueField:c.PropTypes.string,chartHeight:c.PropTypes.number.isRequired,chartWidth:c.PropTypes.number.isRequired,className:c.PropTypes.string.isRequired,data:c.PropTypes.array,loading:c.PropTypes.bool,onClick:c.PropTypes.func,onEnter:c.PropTypes.func,onLeave:c.PropTypes.func,status:c.PropTypes.string,xScale:c.PropTypes.any,yScale:c.PropTypes.any},t["default"]=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=n(1),f=r(p),d=n(5),h=r(d),y=function(e){return e[0].map(function(t,n){return e.map(function(e){return e[n]})})},m=function(e){function t(e){i(this,t);var n=s(this,Object.getPrototypeOf(t).call(this,e));return n.state={xDomain:[],yDomain:[1e-5,1]},n}return l(t,e),c(t,[{key:"componentWillReceiveProps",value:function(e){if(e.data.length>0){var t=this.getMaxCount(e.data),n=e.data[0].bins.map(function(e){return e.x.toString()});t!==this.props.yScale.domain()[1]&&(console.log(this.state.yDomain[0],t),this.props.yScale.domain([this.state.yDomain[0],t]),this.setState({yDomain:[this.state.yDomain[0],t]})),n!==this.state.xDomain&&(this.props.xScale.domain(n),this.setState({xDomain:n}))}}},{key:"getMaxCount",value:function(e){var t=0;if("stacked"===this.props.type){var n=e.reduce(function(e,t,n){return n>0&&t.bins.map(function(t,n){e[n]+=t.y}),e},e[0].bins.map(function(e){return e.y}));t=Math.max.apply(Math,a(n))}else t=e.reduce(function(e,t){var n=Math.max.apply(Math,a(t.bins.map(function(e){return e.y})));return n>e?n:e},0);return t}},{key:"addOverlay",value:function(e){for(var t=0;t<e.length;t++){var n=u({},e[t][0]);n.className="_overlay",n.key=n.className+"-"+n.data.x,n.y=1,n.tooltipData={},n.tooltipData.label=e[t][0].data.x,n.tooltipData.stackNames=e[t].reduce(function(e,t){return t?[t.name].concat(e):[""].concat(e)},[]),n.tooltipData.stackCounts=e[t].reduce(function(e,t){return t?[t.data.y].concat(e):[0].concat(e)},[]),n.tooltipData.yPos=e[t][0].y,n.tooltipData.xPos=this.props.xScale(e[t][0].data.x),n.height=this.props.yScale.range()[0],e[t].push(n)}}},{key:"buildABar",value:function(e,t,n,r,o,a){var i=n.toString()+"-"+e.x.toString();return{name:t,className:n.toString(),key:i,height:r,data:e,width:o,y:a}}},{key:"renderHistogram",value:function(){var e=this,t=this.props,n=t.chartWidth,r=t.chartHeight,a=o(t,["chartWidth","chartHeight"]),i=a.data[0].bins.length,s=n*(1-a.padding).toFixed(2),l=Math.ceil(s/(i+2*a.outerPadding));"function"==typeof a.xScale.rangePoints?a.xScale.rangeRoundBands([0,n],a.padding,a.outerPadding):a.xScale.range([0,n]);var c=y(a.data.map(function(t,n){return t.bins.map(function(t){var o=r-a.yScale(t.y),i=t.y>0?Math.max(Math.floor(o),3):0,s=r-i;return e.buildABar(t,a.data[n].name,a.data[n].type,i,l,s)})}));a.addOverlay===!0&&this.addOverlay(c);var p=c.map(function(e,t){return e.map(function(t,n){return t?("stacked"===a.type&&n>0&&"_overlay"!==t.className&&(t.y=e[n-1].y-t.height),f["default"].createElement(h["default"],u({},t,{onClick:a.onBarClick,onEnter:a.onEnter,onLeave:a.onLeave}))):null})}),d=p.map(function(e,t){var n=0,r=a.xScale(c[t][0].data.x);return null==r&&(r=0),f["default"].createElement("g",{className:"bin",key:a.className+"-"+t.toString(),transform:"translate("+r+","+n+")"},e)});return f["default"].createElement("g",null,d)}},{key:"renderLoadAnimation",value:function(e){var t=e.chartWidth,n=e.chartHeight,r=Math.floor(t/2),o=Math.floor(n/2),a="Loading data...";return e.loading||(a="Failed to fetch"===e.status?"Can't connect to API URL":"OK"!==e.status?"Error retrieving data: "+e.status:"No data returned!"),f["default"].createElement("g",{className:"loading-message"},f["default"].createElement("text",{x:r,y:o},a))}},{key:"render",value:function(){var e=null;return e=this.renderLoadAnimation(this.props),this.props.data.length>0&&(e=this.renderHistogram(this.props)),e}}]),t}(f["default"].Component);m.defaultProps={addOverlay:!0,padding:.2,outerPadding:.4,chartHeight:0,chartWidth:0,className:"histogram",data:[],loading:!1,status:"",type:"",onBarClick:function(){},onEnter:function(){},onLeave:function(){}},m.propTypes={addOverlay:p.PropTypes.bool,padding:p.PropTypes.number.isRequired,outerPadding:p.PropTypes.number.isRequired,chartHeight:p.PropTypes.number.isRequired,chartWidth:p.PropTypes.number.isRequired,className:p.PropTypes.string.isRequired,data:p.PropTypes.array,loading:p.PropTypes.bool,onBarClick:p.PropTypes.func,onEnter:p.PropTypes.func,onLeave:p.PropTypes.func,status:p.PropTypes.string,type:p.PropTypes.string,xScale:p.PropTypes.any,yScale:p.PropTypes.any},t["default"]=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),c=r(u),p=n(2),f=r(p);Object.byString=function(e,t){t=t.replace(/\[(\w+)\]/g,".$1"),t=t.replace(/^\./,"");for(var n=t.split("."),r=0,o=n.length;r<o;++r){var a=n[r];if(!(a in e))return;e=e[a]}return e};var d=function(e){function t(){return o(this,t),a(this,Object.getPrototypeOf(t).apply(this,arguments))}return i(t,e),l(t,[{key:"render",value:function(){if(null===this.props.component)return c["default"].createElement("g",null);var e=this.props,t=e.component,n=e.scaleAccessor,r=e.height,o=e.width,a=e.margin,i=Object.byString(t,n),l=0,u=r+a.bottom/2,p=o/i.range().length,d=4;return c["default"].createElement("g",{className:"legend",transform:"translate("+l+","+u+")"},i.range().map(function(e,t){var n={x:t*p,y:0,width:p,height:d,fill:e};return c["default"].createElement("rect",s({
key:t},n))}),c["default"].createElement("text",{x:0,y:14},f["default"].format("n")(Math.round(i.domain()[0]))),c["default"].createElement("text",{x:i.range().length*p,y:15,textAnchor:"end"},f["default"].format("n")(Math.round(i.domain()[i.domain().length-1]))))}}]),t}(c["default"].Component);d.defaultProps={component:null,scaleAccessor:"state.colorScale",margin:{top:0,right:0,bottom:0,left:0},height:0,width:0},d.propTypes={component:u.PropTypes.any,scaleAccessor:u.PropTypes.string,margin:u.PropTypes.object,height:u.PropTypes.number,width:u.PropTypes.number},t["default"]=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(1),u=r(l),c=function(e){function t(){return o(this,t),a(this,Object.getPrototypeOf(t).apply(this,arguments))}return i(t,e),s(t,[{key:"render",value:function(){var e=this.props,t=e.chartWidth,n=e.chartHeight,r=Math.floor(t/2),o=Math.floor(n/2),a="TODO: Scatterplot Component";return u["default"].createElement("g",{className:"loading-message"},u["default"].createElement("text",{x:r,y:o},a))}}]),t}(u["default"].Component);c.defaultProps={chartHeight:0,chartWidth:0,data:[],loading:!1,status:""},c.propTypes={chartHeight:l.PropTypes.number.isRequired,chartWidth:l.PropTypes.number.isRequired,data:l.PropTypes.array,loading:l.PropTypes.bool,status:l.PropTypes.string},t["default"]=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),c=r(u),p=function(e){function t(e){o(this,t);var n=a(this,Object.getPrototypeOf(t).call(this,e));return n.onChange=n.onChange.bind(n),n}return i(t,e),l(t,[{key:"onChange",value:function(e){var t=this.props;t.onChange(e.target.value,t.chart)}},{key:"render",value:function(){var e=this.props,t=e.chart;return c["default"].createElement("div",null,c["default"].createElement("label",null,e.label),c["default"].createElement("select",{onChange:this.onChange,value:e.defaultSelected(t)},e.options.map(function(e,t){return c["default"].createElement("option",{key:t,value:e},e)})))}}]),t}(c["default"].Component),f=function(e){function t(e){o(this,t);var n=a(this,Object.getPrototypeOf(t).call(this,e));return n.state={menuDisplay:"none",menuZIndex:-9998},n.openMenu=n.openMenu.bind(n),n}return i(t,e),l(t,[{key:"openMenu",value:function(){var e="none"===this.state.menuDisplay?"block":"none";this.setState({menuDisplay:e,menuZIndex:9998})}},{key:"render",value:function(){var e=this.props,t=e.settings,n=e.chart,r=n.props.margin,o=n.state.chartWidth,a=n.state.chartHeight,i={className:"settings-container",style:{position:"absolute",top:0,left:0}},l={className:e.icon+" settings-icon",style:{zIndex:9999,position:"absolute",top:0,left:o+r.left},onClick:this.openMenu},u={className:"settings-menu",style:{position:"absolute",display:this.state.menuDisplay,zIndex:this.state.menuZIndex,width:(o+r.left)/2,height:a,top:0,left:(o+r.left)/2}};return c["default"].createElement("div",i,c["default"].createElement("span",l),c["default"].createElement("div",u,c["default"].createElement("span",{className:"settings-title"},t.title),t.options.map(function(e,t){if("dropdown"===e.type)return c["default"].createElement(p,s({key:t,chart:n},e))})))}}]),t}(c["default"].Component);f.defaultProps={settings:{},chart:null,icon:"icono-gear"},f.propTypes={settings:u.PropTypes.object,chart:u.PropTypes.object,icon:u.PropTypes.string},t["default"]=f},function(e,t){function n(e,t,n){function r(t){var n=y,r=m;return y=m=void 0,O=t,v=e.apply(r,n)}function a(e){return O=e,b=setTimeout(c,t),k?r(e):v}function i(e){var n=e-E,r=e-O,o=t-n;return j?T(o,g-r):o}function u(e){var n=e-E,r=e-O;return!E||n>=t||n<0||j&&r>=g}function c(){var e=x();return u(e)?p(e):void(b=setTimeout(c,i(e)))}function p(e){return clearTimeout(b),b=void 0,w&&y?r(e):(y=m=void 0,v)}function f(){void 0!==b&&clearTimeout(b),E=O=0,y=m=b=void 0}function d(){return void 0===b?v:p(x())}function h(){var e=x(),n=u(e);if(y=arguments,m=this,E=e,n){if(void 0===b)return a(E);if(j)return clearTimeout(b),b=setTimeout(c,t),r(E)}return void 0===b&&(b=setTimeout(c,t)),v}var y,m,g,v,b,E=0,O=0,k=!1,j=!1,w=!0;if("function"!=typeof e)throw new TypeError(l);return t=s(t)||0,o(n)&&(k=!!n.leading,j="maxWait"in n,g=j?P(s(n.maxWait)||0,t):g,w="trailing"in n?!!n.trailing:w),h.cancel=f,h.flush=d,h}function r(e){var t=o(e)?b.call(e):"";return t==c||t==p}function o(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function a(e){return!!e&&"object"==typeof e}function i(e){return"symbol"==typeof e||a(e)&&b.call(e)==f}function s(e){if("number"==typeof e)return e;if(i(e))return u;if(o(e)){var t=r(e.valueOf)?e.valueOf():e;e=o(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(d,"");var n=y.test(e);return n||m.test(e)?g(e.slice(2),n?2:8):h.test(e)?u:+e}var l="Expected a function",u=NaN,c="[object Function]",p="[object GeneratorFunction]",f="[object Symbol]",d=/^\s+|\s+$/g,h=/^[-+]0x[0-9a-f]+$/i,y=/^0b[01]+$/i,m=/^0o[0-7]+$/i,g=parseInt,v=Object.prototype,b=v.toString,P=Math.max,T=Math.min,x=Date.now;e.exports=n},function(e,t,n){!function(e,n){n(t)}(this,function(e){"use strict";function t(){}function n(e){if(!e)return t;var n,r,o=e.scale[0],a=e.scale[1],i=e.translate[0],s=e.translate[1];return function(e,t){t||(n=r=0),e[0]=(n+=e[0])*o+i,e[1]=(r+=e[1])*a+s}}function r(e){if(!e)return t;var n,r,o=e.scale[0],a=e.scale[1],i=e.translate[0],s=e.translate[1];return function(e,t){t||(n=r=0);var l=Math.round((e[0]-i)/o),u=Math.round((e[1]-s)/a);e[0]=l-n,e[1]=u-r,n=l,r=u}}function o(e,t){for(var n,r=e.length,o=r-t;o<--r;)n=e[o],e[o++]=e[r],e[r]=n}function a(e,t){for(var n=0,r=e.length;n<r;){var o=n+r>>>1;e[o]<t?n=o+1:r=o}return n}function i(e,t){return"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map(function(t){return s(e,t)})}:s(e,t)}function s(e,t){var n={type:"Feature",id:t.id,properties:t.properties||{},geometry:l(e,t)};return null==t.id&&delete n.id,n}function l(e,t){function r(e,t){t.length&&t.pop();for(var n,r=p[e<0?~e:e],a=0,i=r.length;a<i;++a)t.push(n=r[a].slice()),c(n,a);e<0&&o(t,i)}function a(e){return e=e.slice(),c(e,0),e}function i(e){for(var t=[],n=0,o=e.length;n<o;++n)r(e[n],t);return t.length<2&&t.push(t[0].slice()),t}function s(e){for(var t=i(e);t.length<4;)t.push(t[0].slice());return t}function l(e){return e.map(s)}function u(e){var t=e.type;return"GeometryCollection"===t?{type:t,geometries:e.geometries.map(u)}:t in f?{type:t,coordinates:f[t](e)}:null}var c=n(e.transform),p=e.arcs,f={Point:function(e){return a(e.coordinates)},MultiPoint:function(e){return e.coordinates.map(a)},LineString:function(e){return i(e.arcs)},MultiLineString:function(e){return e.arcs.map(i)},Polygon:function(e){return l(e.arcs)},MultiPolygon:function(e){return e.arcs.map(l)}};return u(t)}function u(e,t){function n(t){var n,r=e.arcs[t<0?~t:t],o=r[0];return e.transform?(n=[0,0],r.forEach(function(e){n[0]+=e[0],n[1]+=e[1]})):n=r[r.length-1],t<0?[n,o]:[o,n]}function r(e,t){for(var n in e){var r=e[n];delete t[r.start],delete r.start,delete r.end,r.forEach(function(e){o[e<0?~e:e]=1}),s.push(r)}}var o={},a={},i={},s=[],l=-1;return t.forEach(function(n,r){var o,a=e.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(o=t[++l],t[l]=n,t[r]=o)}),t.forEach(function(e){var t,r,o=n(e),s=o[0],l=o[1];if(t=i[s])if(delete i[t.end],t.push(e),t.end=l,r=a[l]){delete a[r.start];var u=r===t?t:t.concat(r);a[u.start=t.start]=i[u.end=r.end]=u}else a[t.start]=i[t.end]=t;else if(t=a[l])if(delete a[t.start],t.unshift(e),t.start=s,r=i[s]){delete i[r.end];var c=r===t?t:r.concat(t);a[c.start=r.start]=i[c.end=t.end]=c}else a[t.start]=i[t.end]=t;else t=[e],a[t.start=s]=i[t.end=l]=t}),r(i,a),r(a,i),t.forEach(function(e){o[e<0?~e:e]||s.push([e])}),s}function c(e){return l(e,p.apply(this,arguments))}function p(e,t,n){function r(e){var t=e<0?~e:e;(c[t]||(c[t]=[])).push({i:e,g:l})}function o(e){e.forEach(r)}function a(e){e.forEach(o)}function i(e){"GeometryCollection"===e.type?e.geometries.forEach(i):e.type in p&&(l=e,p[e.type](e.arcs))}var s=[];if(arguments.length>1){var l,c=[],p={LineString:o,MultiLineString:a,Polygon:a,MultiPolygon:function(e){e.forEach(a)}};i(t),c.forEach(arguments.length<3?function(e){s.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&s.push(e[0].i)})}else for(var f=0,d=e.arcs.length;f<d;++f)s.push(f);return{type:"MultiLineString",arcs:u(e,s)}}function f(e){var t=e[0],n=e[1],r=e[2];return Math.abs((t[0]-r[0])*(n[1]-t[1])-(t[0]-n[0])*(r[1]-t[1]))}function d(e){for(var t,n=-1,r=e.length,o=e[r-1],a=0;++n<r;)t=o,o=e[n],a+=t[0]*o[1]-t[1]*o[0];return a/2}function h(e){return l(e,y.apply(this,arguments))}function y(e,t){function n(e){e.forEach(function(t){t.forEach(function(t){(o[t=t<0?~t:t]||(o[t]=[])).push(e)})}),a.push(e)}function r(t){return Math.abs(d(l(e,{type:"Polygon",arcs:[t]}).coordinates[0]))}var o={},a=[],i=[];return t.forEach(function(e){"Polygon"===e.type?n(e.arcs):"MultiPolygon"===e.type&&e.arcs.forEach(n)}),a.forEach(function(e){if(!e._){var t=[],n=[e];for(e._=1,i.push(t);e=n.pop();)t.push(e),e.forEach(function(e){e.forEach(function(e){o[e<0?~e:e].forEach(function(e){e._||(e._=1,n.push(e))})})})}}),a.forEach(function(e){delete e._}),{type:"MultiPolygon",arcs:i.map(function(t){var n,a=[];if(t.forEach(function(e){e.forEach(function(e){e.forEach(function(e){o[e<0?~e:e].length<2&&a.push(e)})})}),a=u(e,a),(n=a.length)>1)for(var i,s,l=1,c=r(a[0]);l<n;++l)(i=r(a[l]))>c&&(s=a[0],a[0]=a[l],a[l]=s,c=i);return a})}}function m(e){function t(e,t){e.forEach(function(e){e<0&&(e=~e);var n=o[e];n?n.push(t):o[e]=[t]})}function n(e,n){e.forEach(function(e){t(e,n)})}function r(e,t){"GeometryCollection"===e.type?e.geometries.forEach(function(e){r(e,t)}):e.type in s&&s[e.type](e.arcs,t)}var o={},i=e.map(function(){return[]}),s={LineString:t,MultiLineString:n,Polygon:n,MultiPolygon:function(e,t){e.forEach(function(e){n(e,t)})}};e.forEach(r);for(var l in o)for(var u=o[l],c=u.length,p=0;p<c;++p)for(var f=p+1;f<c;++f){var d,h=u[p],y=u[f];(d=i[h])[l=a(d,y)]!==y&&d.splice(l,0,y),(d=i[y])[l=a(d,h)]!==h&&d.splice(l,0,h)}return i}function g(e,t){return e[1][2]-t[1][2]}function v(){function e(e,t){for(;t>0;){var n=(t+1>>1)-1,o=r[n];if(g(e,o)>=0)break;r[o._=t]=o,r[e._=t=n]=e}}function t(e,t){for(;;){var n=t+1<<1,a=n-1,i=t,s=r[i];if(a<o&&g(r[a],s)<0&&(s=r[i=a]),n<o&&g(r[n],s)<0&&(s=r[i=n]),i===t)break;r[s._=t]=s,r[e._=t=i]=e}}var n={},r=[],o=0;return n.push=function(t){return e(r[t._=o]=t,o++),o},n.pop=function(){if(!(o<=0)){var e,n=r[0];return--o>0&&(e=r[o],t(r[e._=0]=e,0)),n}},n.remove=function(n){var a,i=n._;if(r[i]===n)return i!==--o&&(a=r[o],(g(a,n)<0?e:t)(r[a._=i]=a,i)),i},n}function b(e,t){function o(e){s.remove(e),e[1][2]=t(e),s.push(e)}var a=n(e.transform),i=r(e.transform),s=v();return t||(t=f),e.arcs.forEach(function(e){var n,r,l,u,c=[],p=0;for(r=0,l=e.length;r<l;++r)u=e[r],a(e[r]=[u[0],u[1],1/0],r);for(r=1,l=e.length-1;r<l;++r)n=e.slice(r-1,r+2),n[1][2]=t(n),c.push(n),s.push(n);for(r=0,l=c.length;r<l;++r)n=c[r],n.previous=c[r-1],n.next=c[r+1];for(;n=s.pop();){var f=n.previous,d=n.next;n[1][2]<p?n[1][2]=p:p=n[1][2],f&&(f.next=d,f[2]=n[2],o(f)),d&&(d.previous=f,d[0]=n[0],o(d))}e.forEach(i)}),e}var P="1.6.26";e.version=P,e.mesh=c,e.meshArcs=p,e.merge=h,e.mergeArcs=y,e.feature=i,e.neighbors=m,e.presimplify=b})},function(e,t){e.exports=r}])});